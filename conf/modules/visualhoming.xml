<!DOCTYPE module SYSTEM "module.dtd">

<module name="visualhoming">
  <doc>
    <description>Fourier-based local visual homing.</description>
    <define name="VISUALHOMING_CAMERA" value="front_camera|bottom_camera" description="Camera to use as input for visual homing"/>
    <define name="VISUALHOMING_GUIDANCE_MAX_BANK" value="0.18" description="Max bank angle in rad"/>
  </doc>
  <settings>
  	<dl_settings>
      <dl_settings name="visual_homing">
        <dl_setting shortname="center_x" param="VISUALHOMING_CENTER_X" var="calibration.center_x" min="0" step="0.01" max="1"/>
        <dl_setting shortname="center_y" param="VISUALHOMING_CENTER_Y" var="calibration.center_y" min="0" step="0.01" max="1"/>
        <dl_setting shortname="radius_top" param="VISUALHOMING_RADIUS_TOP" var="calibration.radius_top" min="0" step="0.01" max="0.5"/>
        <dl_setting shortname="radius_bottom" param="VISUALHOMING_RADIUS_BOTTOM" var="calibration.radius_bottom" min="0" step="0.01" max="0.5"/>
        <dl_setting shortname="env_radius" param="VISUALHOMING_ENV_RADIUS" var="vh_environment_radius" min="0.5" step="0.5" max="20"/>
        <dl_setting shortname="derotate_gain" param="VISUALHOMING_DEROTATE_GAIN" var="derotate_gain" min="-0.15" step="0.01" max="0.15"/>
        <dl_setting shortname="ss_arr_thres" param="VISUALHOMING_SNAPSHOT_ARRIVAL_THRESHOLD" var="vh_snapshot_arrival_threshold" min="0" step="0.001" max="0.1"/>
        <dl_setting shortname="ss_arr_max_odo" param="VISUALHOMING_SNAPSHOT_ARRIVAL_MAX_ODO" var="vh_snapshot_arrival_max_odo" min="0" step="0.1" max="3.0"/>
        <dl_setting shortname="early_max_odo" param="VISUALHOMING_EARLY_HOMING_MAX_ODO" var="vh_early_homing_max_odo" min="0.0" step="0.1" max="5.0"/>
        <dl_setting shortname="early_max_angle" param="VISUALHOMING_EARLY_HOMING_MAX_ANGULAR_ERROR" var="vh_early_homing_max_angular_error" min="0.0" step="1" max="180"/>
        <dl_setting shortname="early_correct_frames" param="VISUALHOMING_EARLY_HOMING_CORRECT_FRAMES" var="vh_early_homing_correct_frames" min="1" step="1" max="10"/>
        <dl_setting shortname="trig_angle" param="VISUALHOMING_TRIGGER_ANGULAR_ERROR" var="vh_trigger_angular_error" min="0.0" step="1.0" max="180.0"/>
        <dl_setting shortname="trig_min_length" param="VISUALHOMING_TRIGGER_MIN_LENGTH" var="vh_trigger_min_length" min="0.00" step="0.01" max="0.05"/>
        <dl_setting shortname="trig_timeout" param="VISUALHOMING_TRIGGER_TIMEOUT" var="vh_trigger_timeout" min="0.0" step="0.5" max="10.0"/>
        <dl_setting shortname="input_mode" var="vh_gcs_input_mode" min="0" step="1" max="2" values="Snapshot|Odometry|-">
          <strip_button name="Snapshot" value="0" group="vh_input" icon="digital-camera.png"/>
          <strip_button name="Odometry" value="1" group="vh_input" icon="survey_we.png"/>
        </dl_setting>
        <dl_setting shortname="sequencer_mode" var="vh_gcs_seq_mode" min="0" step="1" max="3" values="Stop|Single|Route|-">
          <strip_button name="Stop" value="0" group="vh_seq" icon="off.png"/>
          <strip_button name="Single" value="1" group="vh_seq" icon="line.png"/>
          <strip_button name="Route" value="2" group="vh_seq" icon="path.png"/>
        </dl_setting>
      </dl_settings>
      <dl_settings name="vh_guidance">
        <dl_setting shortname="pgain" var="vh_guidance.gains.p" min="0" step="10" max="300"/>
        <dl_setting shortname="dgain" var="vh_guidance.gains.d" min="0" step="10" max="300"/>
        <dl_setting shortname="igain" var="vh_guidance.gains.i" min="0" step="5" max="100"/>
        <dl_setting shortname="maneuver_time" var="vh_guidance.maneuver_time" min="0.0" step="0.1" max="10.0"/>
      </dl_settings>
    </dl_settings>
  </settings>
  <header>
    <file name="visualhoming.h"/>
    <file name="visualhoming_guidance_h.h"/>
    <file name="visualhoming_video.h"/>
    <file name="visualhoming_odometry.h"/>
  </header>
  <init fun="visualhoming_init()"/>
  <periodic fun="visualhoming_periodic()" freq="200" autorun="TRUE"/>
  <makefile>
  	<define name="PFFFT_SIMD_DISABLE"/>
  	<define name="GUIDANCE_H_MODE_MODULE_SETTING" value="GUIDANCE_H_MODE_MODULE"/>
  	<!-- <define name="GUIDANCE_V_MODE_MODULE_SETTING" value="GUIDANCE_V_MODE_NAV"/> -->
    <file name="visualhoming.c"/>
    <file name="visualhoming_guidance_h.c"/>
    <file name="visualhoming_video.c"/>
    <file name="visualhoming_snapshot.c"/>
    <file name="visualhoming_odometry.c"/>
    <file name="visualhoming_map.c"/>
    <file name="pffft.c" dir="modules/visualhoming/ext/pffft"/>
  </makefile>
</module>


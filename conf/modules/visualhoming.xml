<!DOCTYPE module SYSTEM "module.dtd">

<module name="visualhoming">
  <doc>
    <description>Fourier-based local visual homing.</description>
    <define name="VISUALHOMING_CAMERA" value="front_camera|bottom_camera" description="Camera to use as input for visual homing"/>
    <define name="VISUALHOMING_GUIDANCE_MAX_BANK" value="0.18" description="Max bank angle in rad"/>
  </doc>
  <settings>
  	<dl_settings>
      <dl_settings name="visual_homing">
        <dl_setting shortname="center_x" param="VISUALHOMING_CENTER_X" var="calibration.center_x" min="0" step="0.01" max="1"/>
        <dl_setting shortname="center_y" param="VISUALHOMING_CENTER_Y" var="calibration.center_y" min="0" step="0.01" max="1"/>
        <dl_setting shortname="radius_top" param="VISUALHOMING_RADIUS_TOP" var="calibration.radius_top" min="0" step="0.01" max="0.5"/>
        <dl_setting shortname="radius_bottom" param="VISUALHOMING_RADIUS_BOTTOM" var="calibration.radius_bottom" min="0" step="0.01" max="0.5"/>
        <dl_setting shortname="env_radius" param="VISUALHOMING_ENV_RADIUS" var="vh_environment_radius" min="0.5" step="0.5" max="20"/>
        <dl_setting shortname="derotate_gain" param="VISUALHOMING_DEROTATE_GAIN" var="derotate_gain" min="-0.15" step="0.01" max="0.15"/>
        <dl_setting shortname="ss_arr_thres" param="VISUALHOMING_SNAPSHOT_ARRIVAL_THRESHOLD" var="vh_snapshot_arrival_threshold" min="0" step="0.001" max="0.1"/>
        <dl_setting shortname="ss_init_thres" param="VISUALHOMING_SNAPSHOT_INITIAL_THRESHOLD" var="vh_snapshot_initial_threshold" min="0" step="0.01" max="0.25"/>
        <dl_setting shortname="ss_trig_thres" param="VISUALHOMING_SNAPSHOT_TRIGGER_THRESHOLD" var="vh_snapshot_trigger_threshold" min="0" step="0.1" max="3.14"/>
        <dl_setting shortname="ss_diff_init" param="VISUALHOMING_SNAPSHOT_TRIGGER_FROM_INITIAL" var="vh_snapshot_trigger_from_initial" min="0" step="1" max="1"/>
        <dl_setting shortname="odo_arr_thres" param="VISUALHOMING_ODOMETRY_ARRIVAL_THRESHOLD" var="vh_odometry_arrival_threshold" min="0" step="0.01" max="1.0"/>
        <dl_setting shortname="odo_rebase_thres" var="vh_odo_update_threshold" min="0" step="0.05" max="1.0"/>
        <dl_setting shortname="mode_command" var="vh_mode_cmd" min="0" step="1" max="2">
          <strip_button name="STOP" value="0" group="visualhoming" icon="dcstop.png"/>
          <strip_button name="Snapshot" value="1" group="visualhoming" icon="digital-camera.png"/>
          <strip_button name="Odometry" value="2" group="visualhoming" icon="line.png"/>
        </dl_setting> 
      </dl_settings>
      <dl_settings name="vh_guidance">
        <dl_setting shortname="p_gain" param="VISUALHOMING_GUIDANCE_P" var="vh_guidance_tuning.Kp" min="0" step="0.01" max="5"/>
        <dl_setting shortname="d_gain" param="VISUALHOMING_GUIDANCE_D" var="vh_guidance_tuning.Kd" min="0" step="0.01" max="1"/>
        <dl_setting shortname="f_gain" param="VISUALHOMING_GUIDANCE_FILTER_GAIN" var="vh_guidance_tuning.Kf" min="0" step="0.01" max="1"/>
      </dl_settings>
    </dl_settings>
  </settings>
  <header>
    <file name="visualhoming.h"/>
    <file name="visualhoming_guidance_h.h"/>
    <file name="visualhoming_video.h"/>
    <file name="visualhoming_odometry.h"/>
  </header>
  <init fun="visualhoming_init()"/>
  <periodic fun="visualhoming_periodic()" freq="20" autorun="TRUE"/>
  <makefile>
  	<define name="PFFFT_SIMD_DISABLE"/>
  	<define name="GUIDANCE_H_MODE_MODULE_SETTING" value="GUIDANCE_H_MODE_MODULE"/>
  	<!-- <define name="GUIDANCE_V_MODE_MODULE_SETTING" value="GUIDANCE_V_MODE_NAV"/> -->
    <file name="visualhoming.c"/>
    <file name="visualhoming_guidance_h.c"/>
    <file name="visualhoming_video.c"/>
    <file name="visualhoming_snapshot.c"/>
    <file name="visualhoming_odometry.c"/>
    <file name="visualhoming_map.c"/>
    <file name="pffft.c" dir="modules/visualhoming/ext/pffft"/>
  </makefile>
</module>

